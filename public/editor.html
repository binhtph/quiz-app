<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªânh s·ª≠a Exam - Quiz App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>
                <a href="/">üìù Quiz App</a>
                <span style="font-weight: 400; font-size: 1rem; color: var(--text-muted);"> / Ch·ªânh s·ª≠a</span>
            </h1>
            <div class="flex gap-2">
                <a href="/" class="btn btn-secondary">‚Üê Quay l·∫°i</a>
                <button class="btn btn-secondary" onclick="openImportModal()">üì• Import</button>
                <button class="btn btn-secondary" onclick="openExportModal()">üì§ Export</button>
                <button class="btn btn-primary" onclick="openQuestionModal()">+ Th√™m c√¢u h·ªèi</button>
            </div>
        </header>

        <!-- Import Modal -->
        <div id="import-modal" class="modal-overlay">
            <div class="modal" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>Nh·∫≠p c√¢u h·ªèi t·ª´ vƒÉn b·∫£n</h2>
                    <button class="btn-icon" onclick="closeImportModal()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="mb-2 text-sm text-muted">H·ªó tr·ª£ ƒë·ªãnh d·∫°ng:</p>
                    <ul class="mb-4 text-sm text-muted" style="list-style: disc; padding-left: 1.5rem;">
                        <li><b>Tr·∫Øc nghi·ªám:</b> "1. C√¢u h·ªèi..." ti·∫øp theo l√† "a. sai", "B. ƒê√öNG", "c. sai".</li>
                        <li><b>S·∫Øp x·∫øp:</b> "2. [Order] C√¢u h·ªèi..." ti·∫øp theo l√† "- M·ª•c 1", "- M·ª•c 2" (th·ª© t·ª± ƒë√∫ng).
                        </li>
                        <li><b>Gh√©p c·∫∑p:</b> "3. [Match] C√¢u h·ªèi..." ti·∫øp theo l√† "- Tr√°i -> Ph·∫£i".</li>
                    </ul>
                    <textarea id="import-text" class="form-control" style="height: 300px; font-family: monospace;"
                        placeholder="D√°n n·ªôi dung c√¢u h·ªèi v√†o ƒë√¢y..."></textarea>

                    <div class="checkbox-group" style="margin-top: 1rem;">
                        <input type="checkbox" id="import-clear-old">
                        <label for="import-clear-old" style="color: var(--danger);">X√≥a to√†n b·ªô c√¢u h·ªèi c≈© tr∆∞·ªõc khi
                            nh·∫≠p</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeImportModal()">H·ªßy</button>
                    <button type="button" class="btn btn-primary" onclick="processImport()">Nh·∫≠p c√¢u h·ªèi</button>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="export-modal" class="modal-overlay">
            <div class="modal" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>Xu·∫•t n·ªôi dung Exam</h2>
                    <button class="btn-icon" onclick="closeExportModal()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="tabs"
                        style="margin-bottom: 1rem; display: flex; gap: 1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">
                        <button class="btn-link active" onclick="switchExportTab('text')">Text Format</button>
                        <button class="btn-link" onclick="switchExportTab('json')">JSON Format</button>
                    </div>

                    <div id="export-tab-text">
                        <p class="text-sm text-muted mb-2">ƒê·ªãnh d·∫°ng Text (d√πng ƒë·ªÉ s·ª≠a nhanh v√† Import l·∫°i):</p>
                        <textarea id="export-text" class="form-control" style="height: 300px; font-family: monospace;"
                            readonly></textarea>
                    </div>

                    <div id="export-tab-json" class="hidden">
                        <p class="text-sm text-muted mb-2">ƒê·ªãnh d·∫°ng JSON ƒë·∫ßy ƒë·ªß (d√πng ƒë·ªÉ backup):</p>
                        <textarea id="export-json" class="form-control" style="height: 300px; font-family: monospace;"
                            readonly></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeExportModal()">ƒê√≥ng</button>
                    <button type="button" class="btn btn-primary" id="btn-copy-export" onclick="copyExport()">Sao ch√©p
                        Text</button>
                    <button type="button" class="btn btn-success" id="btn-download-json" onclick="downloadJSON()"
                        style="display:none;">T·∫£i file JSON</button>
                </div>
            </div>
        </div>

        <!-- Exam Info -->
        <div class="card mb-3" id="exam-info">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Editor Layout -->
        <div class="editor-layout">
            <!-- Question List -->
            <div class="question-list">
                <div class="question-list-header">
                    <h3>Danh s√°ch c√¢u h·ªèi</h3>
                </div>
                <div id="question-list-items" class="question-list-items">
                    <div class="empty-state">
                        <p>Ch∆∞a c√≥ c√¢u h·ªèi n√†o</p>
                    </div>
                </div>
            </div>

            <!-- Question Editor -->
            <div id="question-editor" class="question-editor">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    <h3>Ch·ªçn c√¢u h·ªèi ƒë·ªÉ ch·ªânh s·ª≠a</h3>
                    <p>Ho·∫∑c th√™m c√¢u h·ªèi m·ªõi t·ª´ n√∫t ph√≠a tr√™n</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Question Modal -->
    <div id="question-modal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="question-modal-title">Th√™m c√¢u h·ªèi</h2>
                <button class="btn-icon" onclick="closeQuestionModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="question-form" onsubmit="saveQuestion(event)">
                <div class="modal-body">
                    <input type="hidden" id="q-id">

                    <div class="form-group">
                        <label for="q-type">Lo·∫°i c√¢u h·ªèi</label>
                        <select id="q-type" class="form-control" onchange="toggleQuestionType()">
                            <option value="single_choice">Ch·ªçn 1 ƒë√°p √°n (Single Choice)</option>
                            <option value="multiple_choice">Ch·ªçn nhi·ªÅu ƒë√°p √°n (Multiple Choice)</option>
                            <option value="drag_drop">K√©o th·∫£ s·∫Øp x·∫øp (Drag & Drop)</option>
                            <option value="matching">K√©o th·∫£ gh√©p c·∫∑p (Matching)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <div class="flex justify-between items-center mb-1">
                            <label for="q-question">C√¢u h·ªèi *</label>
                            <button type="button" class="btn btn-secondary btn-sm"
                                onclick="triggerImageUpload('q-question')">üì∑ Ch√®n ·∫£nh</button>
                        </div>
                        <textarea id="q-question" class="form-control" placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi..." required
                            oninput="document.getElementById('q-add-preview').innerHTML = renderContent(this.value)"></textarea>
                        <div id="q-add-preview" class="question-preview-box mt-2"></div>
                    </div>

                    <!-- Multiple Choice Options -->
                    <div id="mc-options">
                        <label>C√°c ƒë√°p √°n (ch·ªçn ƒë√°p √°n ƒë√∫ng)</label>
                        <div id="options-editor" class="options-editor">
                            <!-- Dynamically populated -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm add-option-btn" onclick="addOption()">+
                            Th√™m ƒë√°p √°n</button>
                    </div>

                    <!-- Drag Drop Options -->
                    <div id="dd-options" class="hidden">
                        <label>C√°c m·ª•c c·∫ßn s·∫Øp x·∫øp (nh·∫≠p theo th·ª© t·ª± ƒë√∫ng)</label>
                        <div id="dd-items-editor" class="options-editor">
                            <!-- Dynamically populated -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm add-option-btn" onclick="addDragItem()">+
                            Th√™m m·ª•c</button>
                    </div>

                    <!-- Matching Options -->
                    <div id="matching-options" class="hidden">
                        <label>C√°c c·∫∑p gh√©p (tr√°i ‚Üí ph·∫£i)</label>
                        <div id="matching-pairs-editor" class="options-editor">
                            <!-- Dynamically populated -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm add-option-btn"
                            onclick="addMatchingPairModal()">+
                            Th√™m c·∫∑p</button>
                    </div>

                    <!-- Notes -->
                    <div class="form-group" style="margin-top: 1rem;">
                        <div class="flex justify-between items-center mb-1">
                            <label class="notes-label">Ghi ch√∫ (hi·ªÉn th·ªã trong Learn Mode)</label>
                            <button type="button" class="btn btn-secondary btn-sm"
                                onclick="triggerImageUpload('q-notes')">üì∑ Ch√®n ·∫£nh</button>
                        </div>
                        <textarea id="q-notes" class="form-control notes-input"
                            placeholder="Th√™m ghi ch√∫ gi·∫£i th√≠ch ƒë√°p √°n..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeQuestionModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Exam Modal -->
    <div id="edit-exam-modal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Ch·ªânh s·ª≠a th√¥ng tin</h2>
                <button class="btn-icon" onclick="closeEditExamModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form onsubmit="updateExamDetails(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>T√™n Exam</label>
                        <input type="text" id="edit-exam-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>M√¥ t·∫£</label>
                        <textarea id="edit-exam-desc" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Th·ªùi gian (ph√∫t)</label>
                        <input type="number" id="edit-exam-time" class="form-control" min="1" max="180">
                    </div>
                    <div class="form-group">
                        <label>PIN Code (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)</label>
                        <input type="text" id="edit-exam-pin" class="form-control" placeholder="****">
                    </div>

                    <div class="form-group">
                        <label>Logo (t√πy ch·ªçn)</label>
                        <div class="logo-upload" id="logo-upload">
                            <input type="file" id="edit-exam-logo" accept="image/*" onchange="handleLogoUpload(event)"
                                style="display:none">
                            <div id="edit-logo-preview" class="logo-preview"
                                onclick="document.getElementById('edit-exam-logo').click()">
                                <span>üì∑ Click ƒë·ªÉ ch·ªçn logo</span>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditExamModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <footer
        style="margin-top: 3rem; text-align: center; color: var(--text-muted); font-size: 0.9rem; padding-bottom: 2rem;">
        <a href="https://github.com/binhtph/quiz-app" target="_blank"
            style="color: inherit; text-decoration: none; opacity: 0.7; transition: opacity 0.2s;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                style="vertical-align: text-bottom; margin-right: 4px;">
                <path
                    d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
            </svg>
            binhtph/quiz-app
        </a>
    </footer>

    <input type="file" id="general-image-upload" accept="image/*" style="display:none">
    <script src="/js/ticker.js"></script>
    <script src="/js/editor.js"></script>
</body>

</html>